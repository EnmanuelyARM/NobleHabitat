@page "/chat-soporte"

<h3>💬 Chat de Soporte</h3>

<div class="chat-container" style="max-width:600px; margin:auto; border:1px solid #ccc; border-radius:8px; padding:10px; display:flex; flex-direction: column; height:400px; font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;">

    
    <div class="chat-window" style="flex:1; overflow-y:auto; padding:10px; background:#f0f0f0; border-radius:6px; margin-bottom:10px; scrollbar-width: thin; scrollbar-color: #888 #ddd;">
        @foreach (var mensaje in mensajes)
        {
            <div class="mensaje @mensaje.Usuario.ToLower()" style="margin-bottom:10px; display:flex; align-items:flex-start; gap:10px;">
                <div style="font-size:24px; user-select:none;">
                    @(mensaje.Usuario == "Soporte" ? "📞" : "😀")
                </div>
                <div style="background:@(mensaje.Usuario == "Soporte" ? "#d1e7dd" : "#cfe2ff"); padding:10px 15px; border-radius:15px; max-width:75%; box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);">
                    <div style="font-weight:bold; margin-bottom:4px; color:#333;">
                        @mensaje.Usuario <span style="font-weight:normal; font-size:0.8em; color:#666; margin-left:8px;">@mensaje.Hora.ToShortTimeString()</span>
                    </div>
                    <div style="white-space:pre-wrap;">@mensaje.Texto</div>
                </div>
            </div>
        }
    </div>

    
    <div class="chat-input" style="display:flex; gap:10px; align-items:center;">
        <input @bind="nuevoMensaje" @bind:event="oninput" placeholder="Escribe tu mensaje..." class="form-control" style="flex:1; padding:10px; font-size:1rem; border-radius:20px; border:1px solid #ccc;" />
        <button class="btn btn-primary" @onclick="EnviarMensaje" style="border-radius:20px; padding: 8px 20px; font-weight:bold;">
            Enviar 📩
        </button>
        <button class="btn btn-secondary" title="Adjuntar archivo" style="border-radius:20px; font-size:1.2rem; padding:8px 14px;" @onclick="() => { }">
            📎
        </button>
        <button class="btn btn-secondary" title="Emoji" style="border-radius:20px; font-size:1.2rem; padding:8px 14px;" @onclick="() => { }">
            😀
        </button>
    </div>

    
    <div class="chat-status" style="font-size:12px; color:#555; margin-top:8px; text-align:center; font-style:italic;">
        Estado: <span style="color:green;">● Conectado</span>
    </div>

</div>

@code {
    private List<Mensaje> mensajes = new()
    {
        new Mensaje { Usuario = "Soporte", Texto = "¡Hola! ¿En qué puedo ayudarte? 📞", Hora = DateTime.Now.AddMinutes(-5) }
    };
    private string nuevoMensaje = string.Empty;

    private void EnviarMensaje()
    {
        if (!string.IsNullOrWhiteSpace(nuevoMensaje))
        {
            mensajes.Add(new Mensaje { Usuario = "Usuario", Texto = nuevoMensaje, Hora = DateTime.Now });
            nuevoMensaje = string.Empty;

            
            mensajes.Add(new Mensaje { Usuario = "Soporte", Texto = "Gracias por tu mensaje, te responderemos pronto. 😊", Hora = DateTime.Now.AddSeconds(1) });
        }
    }

    private class Mensaje
    {
        public string Usuario { get; set; } = "";
        public string Texto { get; set; } = "";
        public DateTime Hora { get; set; } = DateTime.Now;
    }
}
